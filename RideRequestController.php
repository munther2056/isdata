<?php namespace App\Http\Controllers; use Illuminate\Http\Request; use App\Models\RideRequest; use App\Models\Ride; use App\Models\User; use Illuminate\Support\Facades\DB; class RideRequestController extends Controller { public function requestAndAcceptRide(Request $request) { DB::beginTransaction(); try { $rideRequest = RideRequest::create([ 'rider_id' => $request->rider_id, 'driver_id' => null, 'pickup_location' => $request->pickup_location, 'dropoff_location' => $request->dropoff_location, 'status' => 'requested', ]); $rider = User::find($request->rider_id); $rider->update(['status' => 'on_ride']); $rideRequest->update([ 'status' => 'accepted', 'driver_id' => $request->driver_id, ]); $driver = User::find($request->driver_id); $driver->update(['status' => 'on_ride']); DB::commit(); return response()->json(['ride_request_id' => $rideRequest->ride_request_id]);
} catch (\Exception $e) { DB::rollback(); return response()->json(['error' => $e->getMessage()], 500); }
